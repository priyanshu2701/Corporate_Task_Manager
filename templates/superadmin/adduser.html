<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SuperAdmin Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
     <link
      rel="stylesheet"
      href="{{ url_for('static', filename='./assets/css/main.css') }}"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #f8fafc;
        min-height: 100vh;
        display: flex; /* Ensure body is a flex container for sidebar and main content */
        overflow-x: hidden; /* Prevent horizontal scroll */
      }

      .main-content {
        flex: 1;
        display: flex; /* Make main-content a flex container for sidebar and form */
        flex-direction: column; /* Stack header and form vertically */
        min-height: 100vh;
      }

      /* Styles for the flash messages to appear as notifications - REPLICATED FROM DASHBOARD.HTML */
      .flash-messages {
          position: fixed;
          top: 20px;
          left: 50%; /* Center horizontally */
          transform: translateX(-50%); /* Adjust for exact centering */
          z-index: 1050; /* Ensure it's above other content */
          display: flex;
          flex-direction: column; /* Stack multiple messages vertically */
          gap: 10px; /* Space between messages */
          align-items: center; /* Center items within the flex container */
          width: 100%; /* Take full width to allow centering */
          max-width: 400px; /* Limit overall width of the notification area */
      }

      .flash-messages .alert {
          min-width: 280px; /* Slightly wider */
          max-width: 90%; /* Responsive width for smaller screens */
          padding: 15px 20px;
          border-radius: 0.375rem; /* Standard Bootstrap border-radius (approx 6px) */
          box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075); /* Standard Bootstrap shadow */
          opacity: 1;
          transition: opacity 0.6s ease-out, transform 0.6s ease-out; /* Smooth transition for fade out and slide */
          transform: translateY(0); /* Initial position */
          /* Removed custom border as Bootstrap provides it */
      }

      /* Specific background and text colors for different alert categories (Bootstrap defaults) */
      .flash-messages .alert-success {
          color: #155724; /* Dark green text */
          background-color: #d4edda; /* Light green background */
          border-color: #c3e6cb; /* Green border */
      }
      .flash-messages .alert-danger {
          color: #721c24; /* Dark red text */
          background-color: #f8d7da; /* Light red background */
          border-color: #f5c6cb; /* Red border */
      }
      .flash-messages .alert-info {
          color: #0c5460; /* Dark blue text */
          background-color: #d1ecf1; /* Light blue background */
          border-color: #bee5eb; /* Blue border */
      }
      .flash-messages .alert-warning {
          color: #856404; /* Dark yellow text */
          background-color: #fff3cd; /* Light yellow background */
          border-color: #ffeeba; /* Yellow border */
      }

      /* When Bootstrap's .fade.show is removed and .fade is active, it should transition out */
      .flash-messages .alert.fade:not(.show) {
          opacity: 0;
          transform: translateY(-20px); /* Fade out and slightly move up */
      }

      /* Ensure the close button is styled nicely within the notification */
      .flash-messages .alert .btn-close {
          font-size: 0.9rem;
          padding: 0.5rem;
          margin: -0.5rem -0.5rem -0.5rem auto; /* Adjust position */
      }
      /* END REPLICATED STYLES */


      .form-container {
        flex: 1;
        padding: 40px;
        background: white;
        margin: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      }

      .section-title {
        margin-bottom: 30px;
        padding-bottom: 15px;
        border-bottom: 2px solid #e5e7eb;
      }

      .section-title h4 {
        color: #1e40af;
        font-size: 1.5rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .row {
        display: flex;
        gap: 20px;
        margin-bottom: 0;
      }

      .col-md-6 {
        flex: 1;
      }

      .mb-3 {
        margin-bottom: 20px;
      }

      .form-label {
        display: block;
        margin-bottom: 8px;
        color: #374151;
        font-weight: 500;
        font-size: 0.9rem;
      }

      .form-control, .form-select {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.3s ease;
        background: white;
        outline: none;
      }

      .form-control:focus, .form-select:focus {
        border-color: #2563eb;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
      }

      .form-control::placeholder {
        color: #9ca3af;
      }

      .password-container {
        position: relative;
      }

      .password-toggle {
        position: absolute;
        right: 16px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        color: #6b7280;
        font-size: 1rem;
        transition: color 0.3s ease;
        margin-top: 12px;
      }

      .password-toggle:hover {
        color: #2563eb;
      }

      .btn {
        display: inline-block;
        padding: 12px 24px;
        font-size: 1rem;
        font-weight: 600;
        text-align: center;
        text-decoration: none;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 10px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #2563eb, #1d4ed8);
        color: white;
        box-shadow: 0 2px 10px rgba(37, 99, 235, 0.3);
      }

      .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4);
      }

      /* Mobile Responsive */
      @media (max-width: 768px) {
        .main-content {
          flex-direction: column;
        }

        .sidebar {
          width: 100%;
          height: auto;
          order: 1;
        }

        .form-container {
          margin: 10px;
          padding: 25px 20px;
          order: 2;
        }

        .section-title h4 {
          font-size: 1.3rem;
        }

        .row {
          flex-direction: column;
          gap: 0;
        }

        .col-md-6 {
          flex: none;
        }

        .form-control, .form-select {
          padding: 10px 14px;
        }

        .password-toggle {
          right: 14px;
          margin-top: 10px;
        }
      }

      @media (max-width: 480px) {
        .form-container {
          margin: 5px;
          padding: 20px 15px;
        }

        .section-title h4 {
          font-size: 1.2rem;
        }

        .form-control, .form-select {
          padding: 8px 12px;
          font-size: 0.95rem;
        }

        .password-toggle {
          right: 12px;
          margin-top: 8px;
        }
      }

      /* Form validation styles */
      .form-control:valid {
        border-color: #10b981;
      }

      .form-select option {
        padding: 8px;
      }

      /* Animation */
      .form-container {
        animation: fadeIn 0.5s ease-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body>
    <div class="main-content">
       {% include 'sidebar.html' %}
      <div id="userForm" class="form-container">
        <!-- Flash Messages Block - REPLICATED FROM DASHBOARD.HTML -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="flash-messages">
              {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                  {{ message }}
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}
        <!-- END Flash Messages Block -->

        <div class="section-title">
          <h4>âž• Add New User</h4>
        </div>
        <form action="/add_user" method="POST">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Full Name</label>
              <input
                name="name"
                class="form-control"
                required
                placeholder="Enter full name"
              />
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Email</label>
              <input
                name="email"
                type="email"
                class="form-control"
                required
                placeholder="Enter email address"
              />
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3 password-container">
              <label class="form-label">Password</label>
              <input
                name="password"
                type="password"
                class="form-control"
                id="userPassword"
                required
                placeholder="Set password"
              />
              <span class="password-toggle" onclick="togglePasswordVisibility('userPassword')">
                <i class="fas fa-eye"></i>
              </span>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Role</label>
              <select name="role" class="form-select" required id="userRoleSelect">
                <option value="">Select Role</option>
                {% if session['user_role'] == 'superadmin' %}
                <option value="admin">Admin</option>
                {% endif %}
                <option value="employee">Employee</option>
                <option value="intern">Intern</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Department</label>
                {% if session['user_role'] == 'head' %}
                    <input type="text" class="form-control" value="{{ session['department'] }}" disabled>
                    <input type="hidden" name="department" value="{{ session['department'] }}">
                {% else %}
                    <select name="department" class="form-select" required id="departmentSelect">
                        <option value="">Select Department</option>
                        <option value="Digital">Digital</option>
                        <option value="Graphics">Graphics</option>
                        <option value="Sales">Sales</option>
                        <option value="Developer">Developer</option>
                        <option value="HR">HR</option>
                    </select>
                {% endif %}
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Assigned Head (Optional)</label>
                {% if session['user_role'] == 'head' %}
                    <!-- If user is an Admin, show their name as the fixed Assigned Head -->
                    <input type="text" class="form-control" value="{{ session['username'] }}" disabled>
                {% else %}
                    <!-- If user is a Superadmin, show the dropdown to select a head -->
                    <select name="assigned_head" class="form-select" id="assignedHeadSelect">
                    <option value="">Select Assigned Head</option>
                    {% for user in all_users %}
                    {% if user.id != session['user_id'] %}
                    <option value="{{ user.id }}" data-department="{{ user.department }}">
                      {{ user.name }} ({{ user.role | capitalize }})
                    </option>
                    {% endif %}
                    {% endfor %}
                  </select>
                {% endif %}
            </div>
          </div>
          <button type="submit" class="btn btn-primary">Add User</button>
        </form>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      function togglePasswordVisibility(inputId) {
        const passwordInput = document.getElementById(inputId);
        const toggleIcon = passwordInput.nextElementSibling.querySelector('i');
        
        if (passwordInput.type === 'password') {
          passwordInput.type = 'text';
          toggleIcon.classList.remove('fa-eye');
          toggleIcon.classList.add('fa-eye-slash');
        } else {
          passwordInput.type = 'password';
          toggleIcon.classList.remove('fa-eye-slash');
          toggleIcon.classList.add('fa-eye');
        }
      }

      document.addEventListener('DOMContentLoaded', function() {
        const departmentSelect = document.getElementById('departmentSelect');
        const assignedHeadSelect = document.getElementById('assignedHeadSelect');
        const assignedHeadOptions = Array.from(assignedHeadSelect.options);

        if (departmentSelect) {
            departmentSelect.addEventListener('change', function() {
                const selectedDepartment = this.value;
                
                assignedHeadSelect.innerHTML = ''; // Clear existing options
                
                // Add the default option first
                const defaultOption = document.createElement('option');
                defaultOption.value = "";
                defaultOption.textContent = "Select Assigned Head";
                assignedHeadSelect.appendChild(defaultOption);

                // Filter and add relevant options
                assignedHeadOptions.forEach(option => {
                    if (option.value !== "" && option.dataset.department === selectedDepartment) {
                        assignedHeadSelect.add(option.cloneNode(true));
                    }
                });
            });
        }


        const form = document.querySelector('form');
        const inputs = form.querySelectorAll('.form-control, .form-select');
        
        inputs.forEach(input => {
          input.addEventListener('blur', function() {
            if (this.value.trim() !== '') {
              this.style.borderColor = '#10b981';
            } else if (this.hasAttribute('required')) {
              this.style.borderColor = '#ef4444';
            }
          });
          
          input.addEventListener('focus', function() {
            this.style.borderColor = '#2563eb';
          });
        });

        const flashMessages = document.querySelectorAll('.alert');
        flashMessages.forEach(function(message) {
            setTimeout(function() {
                const bsAlert = bootstrap.Alert.getInstance(message) || new bootstrap.Alert(message);
                bsAlert.close();
            }, 3000);
        });
      });
    </script>
  </body>
</html>
