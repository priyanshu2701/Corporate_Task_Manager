<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ session['user_role'] | capitalize }} Profile</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <!-- Add Bootstrap CSS link here -->
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"> -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='./assets/css/main.css') }}"
    />
    <style>
      /* General Body and Layout */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #f8fafc;
        min-height: 100vh;
        display: flex; /* Ensures body is a flex container for sidebar and main content */
        overflow-x: hidden; /* Prevent horizontal scroll */
      }

      .main-content {
        display: flex; /* Enables flexbox for sidebar and main content area */
        min-height: 100vh;
        flex: 1; /* Allows main-content to grow and fill space */
      }

      /* Main content area next to sidebar */
      .main-content-area {
        flex: 1; /* Allows it to grow and fill remaining space */
        padding: 40px;
        background: white;
        margin: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        animation: fadeIn 0.5s ease-out;
      }

      /* Styles for the flash messages to appear as notifications - REPLICATED */
      .flash-messages {
          position: fixed;
          top: 20px;
          left: 50%; /* Center horizontally */
          transform: translateX(-50%); /* Adjust for exact centering */
          z-index: 1050; /* Ensure it's above other content */
          display: flex;
          flex-direction: column; /* Stack multiple messages vertically */
          gap: 10px; /* Space between messages */
          align-items: center; /* Center items within the flex container */
          width: 100%; /* Take full width to allow centering */
          max-width: 400px; /* Limit overall width of the notification area */
      }

      .flash-messages .alert {
          min-width: 280px; /* Slightly wider */
          max-width: 90%; /* Responsive width for smaller screens */
          padding: 15px 20px;
          border-radius: 0.375rem; /* Standard Bootstrap border-radius (approx 6px) */
          box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075); /* Standard Bootstrap shadow */
          opacity: 1;
          transition: opacity 0.6s ease-out, transform 0.6s ease-out; /* Smooth transition for fade out and slide */
          transform: translateY(0); /* Initial position */
          /* Removed custom border as Bootstrap provides it */
      }

      /* Specific background and text colors for different alert categories (Bootstrap defaults) */
      .flash-messages .alert-success {
          color: #155724; /* Dark green text */
          background-color: #d4edda; /* Light green background */
          border-color: #c3e6cb; /* Green border */
      }
      .flash-messages .alert-danger {
          color: #721c24; /* Dark red text */
          background-color: #f8d7da; /* Light red background */
          border-color: #f5c6cb; /* Red border */
      }
      .flash-messages .alert-info {
          color: #0c5460; /* Dark blue text */
          background-color: #d1ecf1; /* Light blue background */
          border-color: #bee5eb; /* Blue border */
      }
      .flash-messages .alert-warning {
          color: #856404; /* Dark yellow text */
          background-color: #fff3cd; /* Light yellow background */
          border-color: #ffeeba; /* Yellow border */
      }

      /* When Bootstrap's .fade.show is removed and .fade is active, it should transition out */
      .flash-messages .alert.fade:not(.show) {
          opacity: 0;
          transform: translateY(-20px); /* Fade out and slightly move up */
      }

      /* Ensure the close button is styled nicely within the notification */
      .flash-messages .alert .btn-close {
          font-size: 0.9rem;
          padding: 0.5rem;
          margin: -0.5rem -0.5rem -0.5rem auto; /* Adjust position */
      }
      /* END REPLICATED STYLES */

      /* Animation */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Section Titles */
      .section-title-small {
        color: #1e40af;
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 30px;
        padding-bottom: 15px;
        border-bottom: 2px solid #e5e7eb;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .section-title-small i {
        color: #1e40af;
        font-size: 1.5rem;
      }

      /* Form styles */
      .form-control, .form-select {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.3s ease;
        background: white;
        outline: none;
      }

      .form-control:focus, .form-select:focus {
        border-color: #2563eb;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
      }

      .form-label {
        display: block;
        margin-bottom: 8px;
        color: #374151;
        font-weight: 500;
        font-size: 0.9rem;
      }

      .mb-3 {
        margin-bottom: 20px;
      }

      .password-container {
        position: relative;
      }

      .password-toggle {
        position: absolute;
        right: 15px;
        top: 65%;
        transform: translateY(-50%);
        cursor: pointer;
        color: #6b7280;
        font-size: 0.9rem;
        transition: color 0.3s ease;
      }

      .password-toggle:hover {
        color: #374151;
      }

      /* Button styles */
      .btn {
        display: inline-block;
        padding: 10px 20px;
        font-size: 0.9rem;
        font-weight: 600;
        text-align: center;
        text-decoration: none;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-right: 10px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #2563eb, #1d4ed8);
        color: white;
        box-shadow: 0 2px 10px rgba(37, 99, 235, 0.3);
      }

      .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4);
      }

      .btn-secondary {
        background-color: #6c757d;
        color: white;
      }

      .btn-secondary:hover {
        background-color: #5a6268;
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(108, 117, 125, 0.4);
      }

      /* Profile Info Display */
      .profile-info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .profile-info-item {
        background-color: #f8fafc;
        padding: 20px;
        border-radius: 10px;
        border: 1px solid #e5e7eb;
        transition: all 0.3s ease;
      }

      .profile-info-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .profile-info-item strong {
        display: block;
        color: #374151;
        font-size: 0.85rem;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
      }

      .profile-info-item span {
        color: #1f2937;
        font-size: 1.1rem;
        font-weight: 500;
      }

      /* Flash messages (original, will be overridden by .flash-messages .alert) */
      .alert {
        padding: 15px;
        margin-bottom: 20px;
        border: 1px solid transparent;
        border-radius: 8px;
        font-size: 0.95rem;
      }

      .alert-success {
        color: #155724;
        background-color: #d4edda;
        border-color: #c3e6cb;
      }

      .alert-danger {
        color: #721c24;
        background-color: #f8d7da;
        border-color: #f5c6cb;
      }

      .alert-info {
        color: #0c5460;
        background-color: #d1ecf1;
        border-color: #bee5eb;
      }

      .alert-warning {
        color: #856404;
        background-color: #fff3cd;
        border-color: #ffeeba;
      }

      .text-muted {
        color: #6c757d;
      }

      .text-center {
        text-align: center;
      }

      /* Password section styling */
      #passwordChangeSection {
        background: #f8fafc;
        padding: 30px;
        border-radius: 10px;
        border: 1px solid #e5e7eb;
        margin-top: 20px;
      }

      #passwordChangeSection h4 {
        color: #1e40af;
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #e5e7eb;
      }

      /* Mobile Responsive */
      @media (max-width: 768px) {
        .main-content {
          flex-direction: column;
        }

        .main-content-area {
          margin: 10px;
          padding: 25px 20px;
        }

        .section-title-small {
          font-size: 1.3rem;
          margin-bottom: 20px;
        }

        .section-title-small i {
          font-size: 1.3rem;
        }

        .profile-info-grid {
          grid-template-columns: 1fr;
          gap: 15px;
          margin-bottom: 20px;
        }

        .profile-info-item {
          padding: 15px;
        }

        .btn {
          padding: 8px 15px;
          font-size: 0.85rem;
          margin-right: 8px;
        }

        #passwordChangeSection {
          padding: 20px;
        }

        #passwordChangeSection h4 {
          font-size: 1.1rem;
        }
      }

      @media (max-width: 480px) {
        .main-content-area {
          margin: 5px;
          padding: 20px 15px;
        }

        .section-title-small {
          font-size: 1.2rem;
          gap: 8px;
        }

        .section-title-small i {
          font-size: 1.2rem;
        }

        .form-control, .form-select {
          padding: 10px 12px;
          font-size: 0.9rem;
        }

        .form-label {
          font-size: 0.85rem;
        }

        .btn {
          padding: 6px 12px;
          font-size: 0.8rem;
          margin-right: 5px;
        }

        .profile-info-grid {
          grid-template-columns: 1fr;
          gap: 10px;
        }

        .profile-info-item {
          padding: 12px;
        }

        .profile-info-item strong {
          font-size: 0.8rem;
        }

        .profile-info-item span {
          font-size: 1rem;
        }

        #passwordChangeSection {
          padding: 15px;
        }
      }
    </style>
  </head>
  <body>
    <div class="main-content">
      {% include 'sidebar.html' %}
      {# {% include 'superadmin/sidebar.html' %} #}
      {# {% include 'partials/sidebar.html' %} #}

      <div class="main-content-area" id="profileSection">
        <!-- Flash Messages Block - REPLICATED -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="flash-messages">
              {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                  {{ message }}
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}
        <!-- END Flash Messages Block -->

        <div class="section-title-small mb-4">
          <i class="fas fa-user-circle me-2"></i>Your Profile
        </div>

        {% if user %}
        <div class="profile-info-grid">
          <div class="profile-info-item">
            <strong>Name:</strong>
            <span>{{ user.name }}</span>
          </div>
          <div class="profile-info-item">
            <strong>Email:</strong>
            <span>{{ user.email }}</span>
          </div>
          <div class="profile-info-item">
            <strong>Role:</strong>
            <span>{{ user.role }}</span>
          </div>
          <div class="profile-info-item">
            <strong>Department:</strong>
            <span>{{ user.department or 'N/A' }}</span>
          </div>
          
        </div>
        {% else %}
        <p class="text-muted text-center">User data not found.</p>
        {% endif %}


        <div >
          <h4 class="section-title-small mt-5 mb-3">Update Your Password</h4>
          <form action="{{ url_for('update_password') }}" method="POST" class="mt-4">
            <div class="mb-3 password-container">
              <label for="current_password" class="form-label">Current Password</label>
              <input
                type="password"
                class="form-control"
                id="current_password"
                name="current_password"
                required
                placeholder="Enter current password"
              />
              <span class="password-toggle" onclick="togglePasswordVisibility('current_password')">
                <i class="fas fa-eye"></i>
              </span>
            </div>
            <div class="mb-3 password-container">
              <label for="new_password" class="form-label">New Password</label>
              <input
                type="password"
                class="form-control"
                id="new_password"
                name="new_password"
                required
                placeholder="Enter new password"
              />
              <span
                class="password-toggle"
                onclick="togglePasswordVisibility('new_password')"
              >
                <i class="fas fa-eye"></i>
              </span>
            </div>
            <div class="mb-3 password-container">
              <label for="confirm_new_password" class="form-label">Confirm New Password</label>
              <input
                type="password"
                class="form-control"
                id="confirm_new_password"
                name="confirm_new_password"
                required
                placeholder="Confirm new password"
              />
              <span
                class="password-toggle"
                onclick="togglePasswordVisibility('confirm_new_password')"
              >
                <i class="fas fa-eye"></i>
              </span>
            </div>
            <button type="submit" class="btn btn-primary mt-3">Save New Password</button>
          </form>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS for alerts and general functionality -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Function to toggle password visibility
      function togglePasswordVisibility(id) {
        const input = document.getElementById(id);
        const icon = input.nextElementSibling.querySelector('i');
        if (input.type === 'password') {
          input.type = 'text';
          icon.classList.remove('fa-eye');
          icon.classList.add('fa-eye-slash');
        } else {
          input.type = 'password';
          icon.classList.remove('fa-eye-slash');
          icon.classList.add('fa-eye');
        }
      }
      window.togglePasswordVisibility = togglePasswordVisibility;


      // This function is for handling initial display of password section based on flash messages
      document.addEventListener('DOMContentLoaded', function() {
          const passwordSection = document.getElementById('passwordChangeSection');
          const alerts = document.querySelectorAll('.alert');
          let showPasswordSectionOnLoad = false;
          alerts.forEach(alert => {
            // Check for specific password-related messages
            if (alert.textContent.includes('password') || alert.textContent.includes('Password updated')) {
              showPasswordSectionOnLoad = true;
            }
          });

          // If there are password-related flash messages, show the password section on load
          // This part needs to be adjusted if the password section is not a separate div
          // but rather part of the main content area.
          // For now, I'll assume it's a separate section as per original code.
          if (passwordSection && showPasswordSectionOnLoad) {
            passwordSection.style.display = 'block';
          }

          // Form validation feedback
          const form = document.querySelector('#passwordChangeSection form');
          if (form) {
            const inputs = form.querySelectorAll('.form-control');
            
            inputs.forEach(input => {
              input.addEventListener('blur', function() {
                if (this.value.trim() !== '') {
                  this.style.borderColor = '#10b981';
                } else if (this.hasAttribute('required')) {
                  this.style.borderColor = '#ef4444';
                }
              });
              
              input.addEventListener('focus', function() {
                this.style.borderColor = '#2563eb';
              });
            });
          }

          // Automatically dismiss flash messages after 3 seconds - REPLICATED
          const flashMessages = document.querySelectorAll('.alert');
          flashMessages.forEach(function(message) {
              setTimeout(function() {
                  const bsAlert = bootstrap.Alert.getInstance(message) || new bootstrap.Alert(message);
                  bsAlert.close();
              }, 3000); // 3000 milliseconds = 3 seconds
          });
      });

      // The toggleForms function from sidebar.html is not needed here if profile.html is a full page.
      // If profile.html is included as a partial in a dashboard, then the toggleForms logic
      // might still be relevant in the main dashboard template.
      // Assuming profile.html is loaded as its own page via Flask routing.
    </script>
  </body>
</html>
